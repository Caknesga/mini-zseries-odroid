<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Mini-ZSeries Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <h1> Mini-ZSeries Konten√ºbersicht</h1>

    <div class="account-grid">
        {% for name, balance in accounts.items() %}
     <div class="account-box" id="account-{{ name }}" data-threshold="{{ thresholds[name] }}">
            <h2>Konto {{ name }}</h2>
            <p>Saldo: <strong id="balance-{{ name }}">{{ balance }}</strong> EUR</p>

            <input type="number" id="amount-{{ name }}" placeholder="Betrag" min="0" step="1">
            <div class="btn-row">
                <button onclick="updateBalance('{{ name }}', 'deposit')">Einzahlen</button>
                <button onclick="updateBalance('{{ name }}', 'withdraw')">Abheben</button>
            </div>
        <form id="transferForm">
            <input type="text" name="from" placeholder="From Account">
            <input type="text" name="to" placeholder="To Account">
            <input type="number" name="amount" placeholder="Amount">
            <button type="submit">Transfer</button>
        </form>
        <p id="transferResult"></p>
            <p id="status-{{ name }}" class="status"></p>
        </div>
        {% endfor %}
    </div>

    <script>
    async function updateBalance(account, action) {
        const amountInput = document.getElementById(`amount-${account}`);
        const amount = parseFloat(amountInput.value);
        const statusEl = document.getElementById(`status-${account}`);
        const balanceEl = document.getElementById(`balance-${account}`);

        const box = document.getElementById(`account-${account}`);
        const threshold = parseFloat(box.dataset.threshold) || 1000;
        if (amount >= threshold) {
        statusEl.textContent = " M√∂glicher Fraud";
        statusEl.style.color = "#da1e28";
        return;
        }

       

        if (isNaN(amount) || amount <= 0) {
            statusEl.textContent = " Ung√ºltiger Betrag";
            statusEl.style.color = "#da1e28"; // IBM Red
            return;
        }

        try {
            const response = await fetch(`/${action}`, {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({account: account, amount: amount})
            });

            const data = await response.json();

            if (response.ok) {
                balanceEl.textContent = data.balance;
                statusEl.textContent = "Erfolgreich!";
                statusEl.style.color = "#198038"; // IBM Green
            } else {
                statusEl.textContent = ` ${data.error}`;
                statusEl.style.color = "#da1e28";
            }
        } catch (error) {
            statusEl.textContent = "Verbindungsfehler";
            statusEl.style.color = "#da1e28";
        }
    }
    document.getElementById("transferForm").addEventListener("submit", async function(e) {
  e.preventDefault();

  const from = document.getElementById("fromAccount").value;
  const to = document.getElementById("toAccount").value;
  const amount = parseFloat(document.getElementById("transferAmount").value);

  const response = await fetch("/transfer", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ from, to, amount })
  });

  const result = await response.json();
  const resultEl = document.getElementById("transferResult");

  if (response.ok) {
    resultEl.textContent = `‚úÖ Transferred ${amount} EUR from ${from} to ${to}.`;
    resultEl.style.color = "green";

    // üîÑ Refresh balances on page
    for (const [account, balance] of Object.entries(result.balances)) {
      const el = document.getElementById(`balance-${account}`);
      if (el) el.textContent = balance;
    }
  } else {
    resultEl.textContent = `‚ö†Ô∏è ${result.error}`;
    resultEl.style.color = "red";
  }
});
    </script>
</body>
</html>
